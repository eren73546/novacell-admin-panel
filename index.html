<!DOCTYPE html>
<html lang="tr">
<head>
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>NovaCell-3</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
<style>
/* --- ORÄ°JÄ°NAL CSS BAÅLANGICI (DOKUNULMADI) --- */
*{margin:0;padding:0;box-sizing:border-box}:root{--bg-gradient:linear-gradient(135deg,#667eea,#764ba2);--bg-soft:#f5f7ff;--card-bg:#ffffff;--card-border:rgba(255,255,255,0.6);--card-shadow:0 18px 55px rgba(15,23,42,0.20);--primary:#667eea;--primary-soft:#e0e7ff;--primary-strong:#4c51bf;--danger:#e74c3c;--success:#27ae60;--text-main:#1f2933;--text-soft:#6b7280;--glass-bg:rgba(255,255,255,0.86);--glass-border:1px solid rgba(255,255,255,0.7);--bulk-bg:rgba(255,255,255,0.94)}body.dark{--bg-gradient:radial-gradient(circle at top,#0f172a,#020617);--bg-soft:#020617;--card-bg:rgba(15,23,42,0.95);--card-border:1px solid rgba(148,163,184,0.25);--card-shadow:0 18px 60px rgba(0,0,0,0.65);--primary:#818cf8;--primary-soft:rgba(129,140,248,0.12);--primary-strong:#4c51bf;--danger:#fb7185;--success:#22c55e;--text-main:#e5e7eb;--text-soft:#9ca3af;--glass-bg:rgba(15,23,42,0.90);--glass-border:1px solid rgba(148,163,184,0.35);--bulk-bg:rgba(15,23,42,0.96)}body{font-family:'Segoe UI',system-ui,-apple-system,sans-serif;background:var(--bg-gradient);min-height:100vh;color:var(--text-main);-webkit-font-smoothing:antialiased;transition:background .4s ease,color .3s ease}.login-container{display:flex;justify-content:center;align-items:center;min-height:100vh;padding:20px}.login-box{background:var(--glass-bg);padding:40px 34px 34px;border-radius:22px;box-shadow:var(--card-shadow);border-radius:24px;border:var(--glass-border);backdrop-filter:blur(20px);width:100%;max-width:420px;animation:fadeUp .4s ease-out}.login-box h2{text-align:center;color:var(--primary);margin-bottom:8px;font-size:30px;font-weight:800;letter-spacing:.02em}.brand-pill{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:999px;background:rgba(102,126,234,0.08);color:var(--text-soft);font-size:11px;font-weight:600}.brand-dot{width:8px;height:8px;border-radius:50%;background:radial-gradient(circle,#22c55e,#15803d);box-shadow:0 0 6px rgba(34,197,94,.8)}.login-box .subtitle{text-align:center;color:var(--text-soft);font-size:14px;margin:10px 0 26px;line-height:1.6}.form-group{margin-bottom:18px}.form-group label{display:block;margin-bottom:8px;color:var(--text-main);font-weight:600;font-size:14px}.form-group input{width:100%;padding:11px 12px;border:2px solid rgba(148,163,184,0.4);border-radius:10px;font-size:14px;font-weight:500;background:rgba(255,255,255,0.9);outline:none;transition:border .15s,box-shadow .15s,background .2s}body.dark .form-group input{background:rgba(15,23,42,0.9);border-color:rgba(148,163,184,0.5);color:var(--text-main)}.form-group input:focus{border-color:var(--primary);box-shadow:0 0 0 1px rgba(102,126,234,0.35)}.btn{width:100%;padding:11px 12px;background:linear-gradient(135deg,#6366f1,#8b5cf6);color:#fff;border:none;border-radius:999px;font-size:15px;font-weight:700;cursor:pointer;box-shadow:0 10px 25px rgba(79,70,229,0.55);transition:transform .12s,box-shadow .12s,filter .12s}.btn:hover{transform:translateY(-1px);box-shadow:0 14px 30px rgba(79,70,229,0.7);filter:brightness(1.04)}.btn:active{transform:translateY(0);box-shadow:0 8px 18px rgba(79,70,229,0.55)}.error-message{color:#f97373;text-align:center;margin-top:14px;font-size:13px;font-weight:600}.dashboard{display:none}.dashboard.active{display:block}.header{position:sticky;top:0;z-index:50;background:var(--glass-bg);backdrop-filter:blur(22px);-webkit-backdrop-filter:blur(22px);border-bottom:var(--glass-border);padding:14px 22px;box-shadow:0 18px 45px rgba(15,23,42,0.25);display:flex;justify-content:space-between;align-items:center}.header-left{display:flex;align-items:center;gap:12px}.brand-logo{width:32px;height:32px;border-radius:16px;background:conic-gradient(from 160deg,#4f46e5,#7c3aed,#ec4899,#22c55e,#4f46e5);display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden}.brand-logo::after{content:'N3';font-weight:800;font-size:14px;color:white;text-shadow:0 1px 4px rgba(0,0,0,0.4)}.header h1{color:var(--text-main);font-size:22px;font-weight:800;letter-spacing:.03em}.header-sub{font-size:11px;color:var(--text-soft);font-weight:600}.header-actions{display:flex;gap:10px;align-items:center}.btn-logout,.btn-refresh,.export-btn,.btn-theme{padding:8px 16px;color:#fff;border:none;border-radius:999px;cursor:pointer;font-size:13px;font-weight:600;display:inline-flex;align-items:center;gap:6px;box-shadow:0 10px 22px rgba(15,23,42,.30);transition:transform .12s,box-shadow .12s,filter .12s,background .2s}.btn-logout{background:linear-gradient(135deg,#ef4444,#b91c1c)}.btn-refresh{background:linear-gradient(135deg,#22c55e,#16a34a)}.export-btn{background:linear-gradient(135deg,#6366f1,#8b5cf6)}.btn-theme{background:linear-gradient(135deg,#0f172a,#111827);padding-inline:12px;min-width:42px;justify-content:center}.btn-logout:hover,.btn-refresh:hover,.export-btn:hover,.btn-theme:hover{transform:translateY(-1px);box-shadow:0 14px 26px rgba(15,23,42,.45);filter:brightness(1.04)}.notification-bell{position:relative;cursor:pointer;font-size:22px;margin-right:8px}.notification-badge{position:absolute;top:-4px;right:-6px;background:#ef4444;color:#fff;border-radius:999px;min-width:20px;height:20px;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700}.notification-panel{position:absolute;top:56px;right:20px;background:var(--card-bg);border-radius:16px;box-shadow:var(--card-shadow);width:340px;max-height:380px;overflow-y:auto;display:none;z-index:60;border:var(--card-border)}.notification-panel.active{display:block}.notification-item{padding:14px 16px;border-bottom:1px solid rgba(148,163,184,0.25);cursor:pointer;transition:background .15s}.notification-item:hover{background:rgba(148,163,184,0.12)}.notification-item.high{border-left:4px solid #ef4444}.notification-item.medium{border-left:4px solid #f59e0b}.notification-item.low{border-left:4px solid #0ea5e9}.export-menu{position:absolute;top:46px;right:0;background:var(--card-bg);border-radius:14px;box-shadow:var(--card-shadow);display:none;z-index:70;min-width:160px;border:var(--card-border)}.export-menu.active{display:block}.export-menu-item{padding:12px 18px;cursor:pointer;border-bottom:1px solid rgba(148,163,184,0.24);font-weight:600;font-size:13px;color:var(--text-main)}.export-menu-item:last-child{border-bottom:none}.export-menu-item:hover{background:rgba(148,163,184,0.15)}.clock-container{background:var(--card-bg);padding:10px 0;text-align:center;font-size:17px;font-weight:700;color:var(--text-main);box-shadow:var(--card-shadow);margin-bottom:20px;border-radius:14px;border:var(--card-border)}.container{max-width:100%;margin:16px auto 30px;padding:0 16px}.stat-card{background:var(--card-bg);padding:14px 14px 16px;border-radius:16px;box-shadow:var(--card-shadow);border:var(--card-border);position:relative;overflow:hidden}.stat-card h3{color:var(--text-soft);font-size:11px;margin-bottom:4px;text-transform:uppercase;font-weight:700;letter-spacing:.08em}.stat-card .value{font-size:21px;font-weight:800;background:linear-gradient(135deg,#6366f1,#ec4899);-webkit-background-clip:text;-webkit-text-fill-color:transparent;line-height:1.3}.stat-card::after{content:'';position:absolute;right:-40px;bottom:-40px;width:110px;height:110px;border-radius:999px;background:radial-gradient(circle at center,rgba(129,140,248,0.6),transparent);opacity:.5;pointer-events:none}.users-section{background:var(--card-bg);padding:24px 22px 22px;border-radius:20px;box-shadow:var(--card-shadow);border:var(--card-border);margin-top:4px}.users-section h2{margin-bottom:12px;font-size:20px;font-weight:800;display:flex;align-items:center;gap:8px;color:var(--text-main)}.users-section h2 span{font-size:12px;font-weight:600;color:var(--text-soft)}.btn-folder{padding:7px 14px;border:none;border-radius:999px;cursor:pointer;font-size:12px;font-weight:600;background:rgba(148,163,184,0.18);color:var(--text-soft);transition:all .16s;margin-right:4px;white-space:nowrap}.btn-folder:hover{background:rgba(129,140,248,0.23);color:var(--text-main)}.btn-folder.active{background:linear-gradient(135deg,#6366f1,#8b5cf6);color:#fff;box-shadow:0 10px 24px rgba(79,70,229,.55)}.btn-folder-move{background:#9b59b6;color:#fff}.search-bulk-row{display:flex;flex-wrap:wrap;gap:8px;align-items:center;margin-bottom:12px}#searchInput{padding:11px 12px;border:2px solid rgba(148,163,184,0.45);border-radius:12px;margin-bottom:0;width:100%;max-width:none;flex:1 1 260px;font-size:14px;font-weight:500;background:rgba(255,255,255,0.94);outline:none;transition:border .15s,box-shadow .15s,background .2s}body.dark #searchInput{background:rgba(15,23,42,0.96);border-color:rgba(148,163,184,0.6);color:var(--text-main)}#searchInput:focus{border-color:var(--primary);box-shadow:0 0 0 1px rgba(102,126,234,0.45)}.bulk-bar{margin:0;background:var(--bulk-bg);border-radius:16px;padding:6px 10px;display:flex;align-items:center;justify-content:space-between;gap:10px;border:var(--card-border);box-shadow:0 6px 16px rgba(15,23,42,.18)}.bulk-left{display:flex;align-items:center;gap:8px;flex-wrap:wrap}.bulk-master{display:inline-flex;align-items:center;gap:6px;font-size:13px;color:var(--text-main);font-weight:600}.bulk-master input{transform:scale(1.05);cursor:pointer}.bulk-count{font-size:12px;color:var(--text-soft);font-weight:600;padding:3px 8px;border-radius:999px;background:rgba(148,163,184,0.16)}.bulk-right{display:flex;align-items:center;gap:6px;flex-wrap:wrap}.bulk-right select{padding:7px 10px;border-radius:999px;border:2px solid rgba(148,163,184,0.5);font-size:12px;font-weight:600;background:rgba(255,255,255,0.9);outline:none}body.dark .bulk-right select{background:rgba(15,23,42,0.96);color:var(--text-main)}.bulk-btn{padding:7px 12px;border-radius:999px;border:none;font-size:12px;font-weight:700;cursor:pointer;display:inline-flex;align-items:center;gap:4px;box-shadow:0 10px 22px rgba(15,23,42,.35);transition:transform .12s,box-shadow .12s,filter .12s}.bulk-btn:disabled{opacity:.45;cursor:not-allowed;box-shadow:none}.bulk-btn:not(:disabled):hover{transform:translateY(-1px);box-shadow:0 14px 26px rgba(15,23,42,.45);filter:brightness(1.04)}.bulk-move{background:linear-gradient(135deg,#6366f1,#8b5cf6);color:#fff}.bulk-activate{background:linear-gradient(135deg,#22c55e,#16a34a);color:#fff}.bulk-deactivate{background:linear-gradient(135deg,#ef4444,#b91c1c);color:#fff}table{width:100%;border-collapse:collapse;font-size:13px;table-layout:fixed}thead{background:linear-gradient(135deg,#6366f1,#8b5cf6)}th{padding:10px 6px;text-align:left;color:#fff;font-size:11px;font-weight:700;letter-spacing:.06em;text-transform:uppercase}td{padding:9px 6px;border-bottom:1px solid rgba(148,163,184,0.25);overflow:hidden;text-overflow:ellipsis;font-weight:500;color:var(--text-main)}.actions-cell{overflow:visible;white-space:nowrap}tbody tr{transition:background .15s,transform .12s,box-shadow .12s}tbody tr:hover{background:rgba(129,140,248,0.09);transform:translateY(-1px);box-shadow:0 8px 22px rgba(15,23,42,.25)}.row-checkbox{cursor:pointer;width:16px;height:16px}.user-cell{display:flex;align-items:center;gap:8px;min-width:0}.user-avatar{width:26px;height:26px;border-radius:999px;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:800;color:#fff;box-shadow:0 0 0 2px rgba(255,255,255,0.65)}.user-meta{min-width:0}.user-name{font-weight:700;font-size:13px;color:var(--text-main);white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.user-folder-tag{font-size:10px;color:var(--text-soft)}.badge{padding:4px 9px;border-radius:999px;font-size:11px;font-weight:700;display:inline-block;letter-spacing:.02em}.badge-active{background:#d1fae5;color:#065f46}.badge-passive{background:#fee2e2;color:#b91c1c}.badge-unlimited{background:radial-gradient(circle at 0 0,#a855f7,#6366f1);color:#fff;box-shadow:0 0 0 1px rgba(255,255,255,.4)}.badge-gold{background:linear-gradient(135deg,#facc15,#fde68a);color:#854d0e;box-shadow:0 0 0 1px rgba(250,204,21,0.6)}.badge-silver{background:linear-gradient(135deg,#e5e7eb,#cbd5f5);color:#374151;box-shadow:0 0 0 1px rgba(148,163,184,0.7)}.badge-bronze{background:linear-gradient(135deg,#f97316,#fb923c);color:#fff;box-shadow:0 0 0 1px rgba(248,250,252,0.7)}.online-indicator{display:flex;flex-direction:column;align-items:center;gap:3px}.online-dot{font-size:18px}.online-dot.online{animation:pulse 1.5s infinite;text-shadow:0 0 8px rgba(34,197,94,.9)}.online-time{font-size:9px;color:var(--text-soft);font-weight:600}@keyframes pulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.35;transform:scale(1.15)}}.progress-bar{width:100%;height:8px;background:rgba(148,163,184,0.25);border-radius:4px;overflow:hidden}.progress-fill{height:100%;background:linear-gradient(90deg,#6366f1,#ec4899)}.toggle-container{display:flex;align-items:center;gap:5px;justify-content:flex-start}.toggle-switch{position:relative;width:40px;height:22px;cursor:pointer;display:inline-block;flex-shrink:0}.toggle-switch input{opacity:0;width:0;height:0;position:absolute}.slider{position:absolute;top:0;left:0;right:0;bottom:0;background:linear-gradient(135deg,#ef4444,#b91c1c);transition:.3s;border-radius:22px}.slider:before{position:absolute;content:"";height:16px;width:16px;left:3px;bottom:3px;background:#fff;transition:.3s;border-radius:50%}input:checked+.slider{background:linear-gradient(135deg,#22c55e,#16a34a)}input:checked+.slider:before{transform:translateX(18px)}.action-btn{padding:5px 7px;margin:0 1px;border:none;border-radius:7px;cursor:pointer;font-size:11px;font-weight:700;display:inline-flex;align-items:center;gap:3px}.btn-settings{background:#2563eb;color:#fff}.btn-payment{background:#16a34a;color:#fff}.btn-note{background:#7c3aed;color:#fff}.btn-settings:hover{background:#1d4ed8}.btn-payment:hover{background:#15803d}.btn-note:hover{background:#6d28d9}.note-cell{position:relative;max-width:220px;overflow:hidden;cursor:pointer;color:var(--text-soft);font-style:italic;font-size:12px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;line-height:1.35}.note-cell:hover{color:var(--text-main);background:rgba(148,163,184,0.08)}.note-cell.has-note{background:rgba(147,51,234,0.06);border-left:3px solid #8b5cf6;padding-left:7px}.note-cell.empty{color:#cbd5e1}.loading-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(15,23,42,.55);display:none;justify-content:center;align-items:center;z-index:9999}.loading-overlay.active{display:flex}.spinner{border:5px solid #f3f3f3;border-top:5px solid #6366f1;border-radius:50%;width:60px;height:60px;animation:spin 1s linear infinite}@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(15,23,42,.65);z-index:9998;justify-content:center;align-items:center}.modal.active{display:flex}.modal-content{background:var(--card-bg);border-radius:18px;padding:26px 24px;width:90%;max-width:520px;max-height:80vh;overflow-y:auto;box-shadow:var(--card-shadow);border:var(--card-border)}.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px}.modal-header h3{font-size:19px;color:var(--primary);font-weight:800}.modal-close{font-size:26px;cursor:pointer;color:var(--text-soft);font-weight:700}.modal-close:hover{color:var(--text-main)}.modal-form-group{margin-bottom:18px}.modal-form-group label{display:block;margin-bottom:8px;font-weight:700;color:var(--text-main);font-size:13px}.modal-form-group input,.modal-form-group select,.modal-form-group textarea{width:100%;padding:10px 11px;border:2px solid rgba(148,163,184,0.5);border-radius:10px;font-size:14px;font-family:inherit;font-weight:500;background:rgba(255,255,255,0.98)}body.dark .modal-form-group input,body.dark .modal-form-group select,body.dark .modal-form-group textarea{background:rgba(15,23,42,0.96);color:var(--text-main);border-color:rgba(148,163,184,0.65)}.modal-form-group textarea{resize:vertical;min-height:90px}.modal-actions{display:flex;gap:10px;margin-top:22px}.modal-btn{flex:1;padding:11px;border:none;border-radius:999px;cursor:pointer;font-weight:700;font-size:14px}.modal-btn-primary{background:linear-gradient(135deg,#6366f1,#8b5cf6);color:#fff;box-shadow:0 10px 24px rgba(79,70,229,0.6)}.modal-btn-secondary{background:rgba(148,163,184,0.2);color:var(--text-main)}.payment-history{margin-top:16px;padding-top:16px;border-top:1px solid rgba(148,163,184,0.35)}.payment-history h4{margin-bottom:10px;color:var(--primary);font-size:14px;font-weight:700}.payment-item{padding:10px;background:rgba(148,163,184,0.12);border-radius:9px;margin-bottom:8px;font-size:12px;font-weight:500}.payment-item strong{color:var(--primary);font-weight:700}.payment-status{padding:4px 8px;border-radius:999px;font-size:11px;font-weight:700;display:inline-block}.payment-ok{background:#d1fae5;color:#065f46}.payment-warning{background:#fef3c7;color:#92400e}.payment-urgent{background:#fee2e2;color:#b91c1c}.payment-overdue{background:#b91c1c;color:#fee2e2;animation:blink 1s infinite}@keyframes blink{0%,100%{opacity:1}50%{opacity:.75}}#usersCardsContainer{display:none;margin-top:10px}.user-card{background:var(--card-bg);border-radius:14px;padding:10px 11px;margin-bottom:8px;box-shadow:0 10px 26px rgba(15,23,42,.30);border:var(--card-border)}.user-card-header{display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:4px}.user-card-main{display:flex;align-items:center;gap:8px;min-width:0}.user-card-stats{display:flex;flex-wrap:wrap;gap:6px;font-size:11px;color:var(--text-soft)}

/* --- MOBÄ°L UYUMLULUK DÃœZELTMESÄ° (EK) --- */
@media(max-width:900px){
  /* HeaderÄ± alt alta al */
  .header{flex-direction:column;align-items:flex-start;gap:8px}
  .header-actions{margin-top:6px;align-self:flex-end;width: 100%;justify-content: space-between;flex-wrap: wrap;}
  
  /* Arama ve Toplu Ä°ÅŸlem SatÄ±rÄ±nÄ± dÃ¼zelt */
  .search-bulk-row{flex-direction: column; align-items: stretch;}
  #searchInput{width: 100%; max-width: 100%; flex: auto;}
  .bulk-bar{flex-direction: column; align-items: flex-start; gap: 10px;}
  .bulk-right{width: 100%; justify-content: space-between; margin-top: 8px;}
  
  /* Tabloyu kaydÄ±rÄ±labilir yap */
  .users-table-wrapper {
    display: block !important;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    width: 100%;
    margin-bottom: 20px;
  }
  table {
    min-width: 1000px; /* Tablonun bÃ¼zÃ¼ÅŸmesini engeller, kaydÄ±rma aÃ§ar */
  }
  
  /* Online ve Ã–deme Listesini alt alta al */
  .container > div[style*="grid-template-columns:1fr 1fr"] {
    grid-template-columns: 1fr !important;
  }
  
  /* ModallarÄ± ekrana sÄ±ÄŸdÄ±r */
  .modal-content {
    width: 95% !important;
    padding: 16px !important;
    margin: 10px;
  }
  
  /* Bildirim Paneli */
  .notification-panel {
    width: 90vw;
    right: 5vw;
    left: 5vw;
  }
}

@keyframes fadeUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
</style>
</head>
<body>
<div class="loading-overlay" id="loadingOverlay"><div class="spinner"></div></div>
<div class="login-container" id="loginPage">
Â  <div class="login-box">
Â  Â  <div style="display:flex;justify-content:center;margin-bottom:10px;">
Â  Â  Â  <span class="brand-pill">
Â  Â  Â  Â  <span class="brand-dot"></span> NovaCell-3 â€¢ Bireysel Kota
Â  Â  Â  </span>
Â  Â  </div>
Â  Â  <h2>ğŸ” NovaCell-3</h2>
Â  Â  <p class="subtitle">HoÅŸgeldiniz Â· YÃ¶netim paneline eriÅŸmek iÃ§in giriÅŸ yapÄ±n.</p>
Â  Â  <form id="loginForm">
Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  <label>KullanÄ±cÄ± AdÄ±</label>
Â  Â  Â  Â  <input type="text" id="username" required>
Â  Â  Â  </div>
Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  <label>Åifre</label>
Â  Â  Â  Â  <input type="password" id="password" required>
Â  Â  Â  </div>
Â  Â  Â  <button type="submit" class="btn">GiriÅŸ Yap</button>
Â  Â  Â  <div class="error-message" id="loginError"></div>
Â  Â  </form>
Â  </div>
</div>

<div class="dashboard" id="dashboardPage">
Â  <div class="header">
Â  Â  <div class="header-left">
Â  Â  Â  <div class="brand-logo"></div>
Â  Â  Â  <div>
Â  Â  Â  Â  <h1>NovaCell-3</h1>
Â  Â  Â  Â  <div class="header-sub">Bireysel Kota DÃ¶ngÃ¼sÃ¼ Â· SÃ¼re KontrolÃ¼</div>
Â  Â  Â  </div>
Â  Â  </div>
Â  Â  <div class="header-actions">
Â  Â  Â  <button class="btn-theme" id="themeToggleBtn" onclick="toggleTheme()">ğŸŒ™</button>
Â  Â  Â  <div class="notification-bell" onclick="toggleNotifications()">ğŸ””
Â  Â  Â  Â  <span class="notification-badge" id="notificationBadge">0</span>
Â  Â  Â  </div>
Â  Â  Â  <div style="position:relative">
Â  Â  Â  Â  <button class="export-btn" onclick="toggleExportMenu()">Export ğŸ“¥</button>
Â  Â  Â  Â  <div class="export-menu" id="exportMenu">
Â  Â  Â  Â  Â  <div class="export-menu-item" onclick="exportToExcel()">ğŸ“Š Excel</div>
Â  Â  Â  Â  Â  <div class="export-menu-item" onclick="exportToPDF()">ğŸ“„ PDF</div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  Â  <button class="btn-refresh" onclick="refreshData()">ğŸ”„ Yenile</button>
Â  Â  Â  <button class="btn-logout" onclick="logout()">ğŸšª Ã‡Ä±kÄ±ÅŸ</button>
Â  Â  </div>
Â  Â  <div class="notification-panel" id="notificationPanel"></div>
Â  </div>
Â Â 
Â  <div class="container">
Â  Â  <div class="clock-container" id="liveClock">â±ï¸ YÃ¼kleniyor...</div>
Â  Â Â 
Â  Â  <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:14px;margin-bottom:22px">
Â  Â  Â  <div class="stat-card"><h3>ğŸ‘¥ Toplam</h3><div class="value" id="totalUsers">0</div></div>
Â  Â  Â  <div class="stat-card"><h3>âœ… Aktif</h3><div class="value" id="activeUsers">0</div></div>
Â  Â  Â  <div class="stat-card"><h3>ğŸŸ¢ Online</h3><div class="value" id="onlineUsers">0</div></div>
Â  Â  Â  <div class="stat-card"><h3>â¸ï¸ Pasif</h3><div class="value" id="passiveUsers">0</div></div>
Â  Â  Â  <div class="stat-card"><h3>ğŸ“Š T.KullanÄ±m</h3><div class="value" id="totalUsage">0 GB</div></div>
Â  Â  Â  <div class="stat-card"><h3>ğŸ”´ Gecikenler</h3><div class="value" id="overdueCount">0</div></div>
Â  Â  </div>
Â  Â Â 
Â  Â  <div style="display:grid;grid-template-columns:1fr 1fr;gap:18px;margin-bottom:24px">
Â  Â  Â  <div class="stat-card" style="height:360px;overflow-y:auto;">
Â  Â  Â  Â  <h3 style="font-size:17px;margin-bottom:12px;color:var(--primary);position:sticky;top:0;background:var(--card-bg);z-index:1;padding-bottom:8px;border-bottom:1px solid rgba(148,163,184,0.4);font-weight:800">
Â  Â  Â  Â  Â  ğŸŸ¢ Online KullanÄ±cÄ±lar
Â  Â  Â  Â  </h3>
Â  Â  Â  Â  <div id="onlineUsersList"></div>
Â  Â  Â  </div>
Â  Â  Â  <div class="stat-card" style="height:360px;overflow-y:auto;">
Â  Â  Â  Â  <h3 style="font-size:17px;margin-bottom:12px;color:var(--primary);position:sticky;top:0;background:var(--card-bg);z-index:1;padding-bottom:8px;border-bottom:1px solid rgba(148,163,184,0.4);font-weight:800">
Â  Â  Â  Â  Â  âš ï¸ Ã–demesi YaklaÅŸanlar (15 gÃ¼n)
Â  Â  Â  Â  </h3>
Â  Â  Â  Â  <div id="upcomingPaymentsList"></div>
Â  Â  Â  </div>
Â  Â  </div>
Â  Â Â 
Â  Â  <div class="users-section">
Â  Â  Â  <h2>ğŸ‘¥ KullanÄ±cÄ±lar <span>Liste Â· Not Â· Kota Â· KlasÃ¶r Â· Toplu Ä°ÅŸlem</span></h2>
Â  Â  Â Â 
Â  Â  Â  <div style="display:flex;gap:6px;margin-bottom:12px;flex-wrap:wrap">
Â  Â  Â  Â  <button class="btn-folder active" onclick="filterByFolder('TÃ¼mÃ¼')">ğŸ“ TÃ¼mÃ¼</button>
Â  Â  Â  Â  <button class="btn-folder" onclick="filterByFolder('Superbox')">ğŸ“¡ Superbox</button>
Â  Â  Â  Â  <button class="btn-folder" onclick="filterByFolder('AX')">ğŸ“¶ AX</button>
Â  Â  Â  Â  <button class="btn-folder" onclick="filterByFolder('GSM')">ğŸ“± GSM</button>
Â  Â  Â  Â  <button class="btn-folder" onclick="filterByFolder('Ã–ZEL')">ğŸ”’ Ã–zel</button>
Â  Â  Â  Â  <button class="btn-folder" onclick="filterByFolder('KLASÃ–R-1')">ğŸ“ KLASÃ–R-1</button>
Â  Â  Â  Â  <button class="btn-folder" onclick="filterByFolder('KLASÃ–R-2')">ğŸ“ KLASÃ–R-2</button>
Â  Â  Â  Â  <button class="btn-folder" onclick="filterByFolder('KLASÃ–R-3')">ğŸ“ KLASÃ–R-3</button>
Â  Â  Â  Â  <button class="btn-folder" onclick="filterByFolder('KLASÃ–R-4')">ğŸ“ KLASÃ–R-4</button>
Â  Â  Â  </div>
Â  Â  Â Â 
Â  Â  Â  <div class="search-bulk-row">
Â  Â  Â  Â  <input type="text" id="searchInput" placeholder="ğŸ” KullanÄ±cÄ± veya not iÃ§inde ara..." onkeyup="filterUsers()">
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div class="bulk-bar" id="bulkBar">
Â  Â  Â  Â  Â  <div class="bulk-left">
Â  Â  Â  Â  Â  Â  <label class="bulk-master">
Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" id="bulkSelectAll" onchange="toggleSelectAll(this.checked)">
Â  Â  Â  Â  Â  Â  Â  <span>TÃ¼mÃ¼nÃ¼ SeÃ§</span>
Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  <span id="bulkSelectedCount" class="bulk-count">0 seÃ§ili</span>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="bulk-right">
Â  Â  Â  Â  Â  Â  <select id="bulkFolderSelect">
Â  Â  Â  Â  Â  Â  Â  <option value="">ğŸ“ KlasÃ¶r SeÃ§</option>
Â  Â  Â  Â  Â  Â  Â  <option value="TÃ¼mÃ¼">TÃ¼mÃ¼</option>
Â  Â  Â  Â  Â  Â  Â  <option value="Superbox">Superbox</option>
Â  Â  Â  Â  Â  Â  Â  <option value="AX">AX</option>
Â  Â  Â  Â  Â  Â  Â  <option value="GSM">GSM</option>
Â  Â  Â  Â  Â  Â  Â  <option value="Ã–ZEL">Ã–zel</option>
Â  Â  Â  Â  Â  Â  Â  <option value="KLASÃ–R-1">KLASÃ–R-1</option>
Â  Â  Â  Â  Â  Â  Â  <option value="KLASÃ–R-2">KLASÃ–R-2</option>
Â  Â  Â  Â  Â  Â  Â  <option value="KLASÃ–R-3">KLASÃ–R-3</option>
Â  Â  Â  Â  Â  Â  Â  <option value="KLASÃ–R-4">KLASÃ–R-4</option>
Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  <button class="bulk-btn bulk-move" id="bulkMoveBtn" onclick="bulkMove()" disabled>ğŸ“ Toplu TaÅŸÄ±</button>
Â  Â  Â  Â  Â  Â  <button class="bulk-btn bulk-activate" id="bulkActivateBtn" onclick="bulkToggle(true)" disabled>âœ… Toplu Aktif</button>
Â  Â  Â  Â  Â  Â  <button class="bulk-btn bulk-deactivate" id="bulkDeactivateBtn" onclick="bulkToggle(false)" disabled>â›” Toplu Pasif</button>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  Â Â 
Â  Â  Â  <div class="users-table-wrapper" style="overflow-x:auto;margin-top:4px">
Â  Â  Â  Â  <table>
Â  Â  Â  Â  Â  <thead>
Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  <th style="width:4%">SeÃ§</th>
Â  Â  Â  Â  Â  Â  Â  <th style="width:9%">KullanÄ±cÄ±</th>
Â  Â  Â  Â  Â  Â  Â  <th style="width:18%">ğŸ“ Not</th>
Â  Â  Â  Â  Â  Â  Â  <th style="width:7%">Paket</th>
Â  Â  Â  Â  Â  Â  Â  <th style="width:7%">Limit</th>
Â  Â  Â  Â  Â  Â  Â  <th style="width:11%">KullanÄ±m</th>
Â  Â  Â  Â  Â  Â  Â  <th style="width:8%">T.KullanÄ±m</th>
Â  Â  Â  Â  Â  Â  Â  <th style="width:6%">Durum</th>
Â  Â  Â  Â  Â  Â  Â  <th style="width:6%">Online</th>
Â  Â  Â  Â  Â  Â  Â  <th style="width:6%">Fiyat</th>
Â  Â  Â  Â  Â  Â  Â  <th style="width:7%">Ã–deme</th>
Â  Â  Â  Â  Â  Â  Â  <th style="width:12%">Ä°ÅŸlem</th>
Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  </thead>
Â  Â  Â  Â  Â  <tbody id="usersTableBody">
Â  Â  Â  Â  Â  Â  <tr><td colspan="13" style="text-align:center;padding:32px;font-weight:600">YÃ¼kleniyor...</td></tr>
Â  Â  Â  Â  Â  </tbody>
Â  Â  Â  Â  </table>
Â  Â  Â  </div>
Â  Â  Â Â 
Â  Â  Â  <div id="usersCardsContainer"></div>
Â  Â  </div>
Â  </div>
</div>

<div class="modal" id="settingsModal">
Â  <div class="modal-content">
Â  Â  <div class="modal-header">
Â  Â  Â  <h3>âš™ï¸ KullanÄ±cÄ± AyarlarÄ±: <span id="settingsUserName"></span></h3>
Â  Â  Â  <span class="modal-close" onclick="closeSettingsModal()">&times;</span>
Â  Â  </div>
Â  Â  <div class="modal-form-group">
Â  Â  Â  <label>ğŸ“¦ Kota Limiti</label>
Â  Â  Â  <select id="settingsQuota">
Â  Â  Â  Â  <option value="0">SÄ±nÄ±rsÄ±z</option>
Â  Â  Â  Â  <option value="5">5 GB</option><option value="10">10 GB</option><option value="15">15 GB</option>
Â  Â  Â  Â  <option value="20">20 GB</option><option value="25">25 GB</option><option value="30">30 GB</option>
Â  Â  Â  Â  <option value="35">35 GB</option><option value="40">40 GB</option><option value="45">45 GB</option>
Â  Â  Â  Â  <option value="50">50 GB</option><option value="55">55 GB</option><option value="60">60 GB</option>
Â  Â  Â  Â  <option value="65">65 GB</option><option value="70">70 GB</option><option value="75">75 GB</option>
Â  Â  Â  Â  <option value="80">80 GB</option><option value="85">85 GB</option><option value="90">90 GB</option>
Â  Â  Â  Â  <option value="95">95 GB</option><option value="100">100 GB</option>
Â  Â  Â  Â  <option value="150">150 GB</option><option value="200">200 GB</option>
Â  Â  Â  Â  <option value="250">250 GB</option><option value="300">300 GB</option>
Â  Â  Â  Â  <option value="350">350 GB</option><option value="400">400 GB</option>
Â  Â  Â  Â  <option value="450">450 GB</option><option value="500">500 GB</option>
Â  Â  Â  </select>
Â  Â  Â  <small style="color:#e74c3c;font-size:11px;font-weight:700;display:block;margin-top:6px">
Â  Â  Â  Â  âš ï¸ Kota deÄŸiÅŸtiÄŸinde sÄ±fÄ±rlanÄ±r ve yeni 30 gÃ¼nlÃ¼k dÃ¶ngÃ¼ baÅŸlar
Â  Â  Â  </small>
Â  Â  </div>
Â  Â  <div class="modal-form-group">
Â  Â  Â  <label>ğŸ“… Son Kullanma Tarihi</label>
Â  Â  Â  <input type="date" id="settingsExpiryDate">
Â  Â  </div>
Â  Â  <div class="modal-form-group">
Â  Â  Â  <label>ğŸ’° AylÄ±k Fiyat (â‚º)</label>
Â  Â  Â  <input type="number" id="settingsPrice" min="0" step="0.01">
Â  Â  </div>
Â  Â  <div class="modal-form-group">
Â  Â  Â  <label>ğŸ“ Notlar</label>
Â  Â  Â  <textarea id="settingsNotes"></textarea>
Â  Â  </div>
Â  Â  <div class="modal-form-group">
Â  Â  Â  <label>ğŸ“ KlasÃ¶r</label>
Â  Â  Â  <select id="settingsFolder">
Â  Â  Â  Â  <option value="TÃ¼mÃ¼">ğŸ“ TÃ¼mÃ¼</option>
Â  Â  Â  Â  <option value="Superbox">ğŸ“¡ Superbox</option>
Â  Â  Â  Â  <option value="AX">ğŸ“¶ AX</option>
Â  Â  Â  Â  <option value="GSM">ğŸ“± GSM</option>
Â  Â  Â  Â  <option value="Ã–ZEL">ğŸ”’ Ã–zel</option>
Â  Â  Â  Â  <option value="KLASÃ–R-1">ğŸ“ KLASÃ–R-1</option>
Â  Â  Â  Â  <option value="KLASÃ–R-2">ğŸ“ KLASÃ–R-2</option>
Â  Â  Â  Â  <option value="KLASÃ–R-3">ğŸ“ KLASÃ–R-3</option>
Â  Â  Â  Â  <option value="KLASÃ–R-4">ğŸ“ KLASÃ–R-4</option>
Â  Â  Â  </select>
Â  Â  </div>
Â  Â  <div class="modal-actions">
Â  Â  Â  <button class="modal-btn modal-btn-primary" onclick="saveSettings()">ğŸ’¾ Kaydet</button>
Â  Â  Â  <button class="modal-btn modal-btn-secondary" onclick="closeSettingsModal()">âŒ Ä°ptal</button>
Â  Â  </div>
Â  </div>
</div>

<div class="modal" id="paymentModal">
Â  <div class="modal-content">
Â  Â  <div class="modal-header">
Â  Â  Â  <h3>ğŸ’° Ã–deme Al: <span id="paymentUserName"></span></h3>
Â  Â  Â  <span class="modal-close" onclick="closePaymentModal()">&times;</span>
Â  Â  </div>
Â  Â  <div class="modal-form-group">
Â  Â  Â  <label>Tutar (â‚º)</label>
Â  Â  Â  <input type="number" id="paymentAmount" min="0" step="0.01">
Â  Â  </div>
Â  Â  <div class="modal-form-group">
Â  Â  Â  <label>Ã–deme Tarihi</label>
Â  Â  Â  <input type="date" id="paymentDate">
Â  Â  </div>
Â  Â  <div class="modal-form-group">
Â  Â  Â  <label>Ã–deme YÃ¶ntemi</label>
Â  Â  Â  <select id="paymentMethod">
Â  Â  Â  Â  <option value="Nakit">Nakit</option>
Â  Â  Â  Â  <option value="Havale">Havale/EFT</option>
Â  Â  Â  Â  <option value="Kredi KartÄ±">Kredi KartÄ±</option>
Â  Â  Â  Â  <option value="DiÄŸer">DiÄŸer</option>
Â  Â  Â  </select>
Â  Â  </div>
Â  Â  <div class="modal-form-group">
Â  Â  Â  <label>Not</label>
Â  Â  Â  <input type="text" id="paymentNote">
Â  Â  </div>
Â  Â  <div class="payment-history" id="paymentHistorySection" style="display:none">
Â  Â  Â  <h4>ğŸ“‹ Ã–deme GeÃ§miÅŸi</h4>
Â  Â  Â  <div id="paymentHistoryList"></div>
Â  Â  </div>
Â  Â  <div class="modal-actions">
Â  Â  Â  <button class="modal-btn modal-btn-primary" onclick="savePayment()">ğŸ’° Ã–deme AldÄ±m</button>
Â  Â  Â  <button class="modal-btn modal-btn-secondary" onclick="closePaymentModal()">âŒ Ä°ptal</button>
Â  Â  </div>
Â  </div>
</div>

<div class="modal" id="noteModal">
Â  <div class="modal-content">
Â  Â  <div class="modal-header">
Â  Â  Â  <h3>ğŸ“ Not DÃ¼zenle: <span id="noteUserName"></span></h3>
Â  Â  Â  <span class="modal-close" onclick="closeNoteModal()">&times;</span>
Â  Â  </div>
Â  Â  <div class="modal-form-group">
Â  Â  Â  <label>Not</label>
Â  Â  Â  <textarea id="noteText" rows="5" placeholder="KullanÄ±cÄ± hakkÄ±nda notlarÄ±nÄ±zÄ± buraya yazÄ±n..."></textarea>
Â  Â  </div>
Â  Â  <div class="modal-actions">
Â  Â  Â  <button class="modal-btn modal-btn-primary" onclick="saveNote()">ğŸ’¾ Kaydet</button>
Â  Â  Â  <button class="modal-btn modal-btn-secondary" onclick="closeNoteModal()">âŒ Ä°ptal</button>
Â  Â  </div>
Â  </div>
</div>

<script>
let allUsers=[];
let currentSettingsEmail='';
let currentPaymentEmail='';
let currentNoteEmail='';
let notifications=[];
let currentFolderFilter='TÃ¼mÃ¼';
let selectedUsers=new Set();

function initTheme(){
Â  try{
Â  Â  const saved=localStorage.getItem('nc-theme');
Â  Â  let isDark=saved?saved==='dark':window.matchMedia&&window.matchMedia('(prefers-color-scheme: dark)').matches;
Â  Â  document.body.classList.toggle('dark',isDark);
Â  Â  updateThemeToggleIcon();
Â  }catch(e){}
}

function toggleTheme(){
Â  const willBeDark=!document.body.classList.contains('dark');
Â  document.body.classList.toggle('dark',willBeDark);
Â  try{localStorage.setItem('nc-theme',willBeDark?'dark':'light');}catch(e){}
Â  updateThemeToggleIcon();
}

function updateThemeToggleIcon(){
Â  const btn=document.getElementById('themeToggleBtn');
Â  if(!btn)return;
Â  btn.textContent=document.body.classList.contains('dark')?'ğŸŒ™':'ğŸŒ';
}

window.addEventListener('DOMContentLoaded',()=>{
Â  initTheme();
Â  checkAuth();
});

async function checkAuth(){
Â  try{
Â  Â  const r=await fetch('/api/check-auth',{credentials:'include'});
Â  Â  if(r.ok){
Â  Â  Â  const d=await r.json();
Â  Â  Â  if(d.authenticated){
Â  Â  Â  Â  showDashboard();
Â  Â  Â  Â  await loadData();
Â  Â  Â  Â  loadNotifications();
Â  Â  Â  Â  startClock();
Â  Â  Â  }else showLogin();
Â  Â  }else showLogin();
Â  }catch(e){showLogin();}
}

document.getElementById('loginForm').addEventListener('submit',async e=>{
Â  e.preventDefault();
Â  const u=document.getElementById('username').value;
Â  const p=document.getElementById('password').value;
Â  const err=document.getElementById('loginError');
Â  err.textContent='';
Â  try{
Â  Â  const r=await fetch('/api/login',{
Â  Â  Â  method:'POST',
Â  Â  Â  headers:{'Content-Type':'application/json'},
Â  Â  Â  credentials:'include',
Â  Â  Â  body:JSON.stringify({username:u,password:p})
Â  Â  });
Â  Â  const d=await r.json();
Â  Â  if(d.success){
Â  Â  Â  showDashboard();
Â  Â  Â  await loadData();
Â  Â  Â  loadNotifications();
Â  Â  Â  startClock();
Â  Â  }else err.textContent=d.message||'HatalÄ± giriÅŸ';
Â  }catch(e){err.textContent='BaÄŸlantÄ± hatasÄ±';}
});

async function logout(){
Â  await fetch('/api/logout',{method:'POST',credentials:'include'});
Â  showLogin();
}

function showLogin(){
Â  document.getElementById('loginPage').style.display='flex';
Â  document.getElementById('dashboardPage').classList.remove('active');
}

function showDashboard(){
Â  document.getElementById('loginPage').style.display='none';
Â  document.getElementById('dashboardPage').classList.add('active');
}

function startClock(){
Â  const clockEl=document.getElementById('liveClock');
Â  function updateTime(){
Â  Â  const now=new Date();
Â  Â  const turkishDate=now.toLocaleDateString('tr-TR',{year:'numeric',month:'2-digit',day:'2-digit'});
Â  Â  const turkishTime=now.toLocaleTimeString('tr-TR',{hour:'2-digit',minute:'2-digit',second:'2-digit'});
Â  Â  clockEl.textContent=`â° ${turkishDate} ${turkishTime}`;
Â  }
Â  updateTime();
Â  setInterval(updateTime,1000);
}

async function loadData(){
Â  await Promise.all([loadStats(),loadUsers()]);
Â  if(allUsers && allUsers.length > 0){ updateCharts(allUsers); }
}

async function loadStats(){
Â  try{
Â  Â  const r=await fetch('/api/stats',{credentials:'include'});
Â  Â  const d=await r.json();
Â  Â  document.getElementById('totalUsers').textContent=d.total_users;
Â  Â  document.getElementById('activeUsers').textContent=d.active_users;
Â  Â  document.getElementById('passiveUsers').textContent=d.passive_users;
Â  Â  document.getElementById('onlineUsers').textContent=d.online_users;
Â  Â  document.getElementById('totalUsage').textContent=d.total_usage_gb+' GB';
Â  Â  document.getElementById('overdueCount').textContent=d.overdue_count;
Â  }catch(e){}
}

async function loadUsers(){
Â  try{
Â  Â  const r=await fetch('/api/users',{credentials:'include'});
Â  Â  allUsers=await r.json();
Â  Â  applyFilters();
Â  Â  updateCharts(allUsers);
Â  }catch(e){}
}

async function loadNotifications(){
Â  try{
Â  Â  const r=await fetch('/api/notifications',{credentials:'include'});
Â  Â  notifications=await r.json();
Â  Â  document.getElementById('notificationBadge').textContent=notifications.length;
Â  Â  displayNotifications();
Â  }catch(e){}
}

function displayNotifications(){
Â  const panel=document.getElementById('notificationPanel');
Â  if(!notifications.length){
Â  Â  panel.innerHTML='<div style="padding:20px;text-align:center;color:#9ca3af;font-weight:600">Bildirim yok</div>';
Â  Â  return;
Â  }
Â  panel.innerHTML=notifications.map(n=>`
Â  Â  <div class="notification-item ${n.priority}">
Â  Â  Â  <strong style="font-weight:700">${n.user}</strong><br>
Â  Â  Â  <span style="font-size:13px;font-weight:600">${n.message}</span>
Â  Â  </div>
Â  `).join('');
}

function toggleNotifications(){
Â  document.getElementById('notificationPanel').classList.toggle('active');
}

function updateCharts(u){
Â  const onlineUsers=u.filter(x=>x.online_status==='online');
Â  const onlineList=document.getElementById('onlineUsersList');
Â  if(!onlineUsers.length){
Â  Â  onlineList.innerHTML='<div style="color:#9ca3af;padding:18px;text-align:center;font-weight:600;font-size:13px;">Åu an online kullanÄ±cÄ± yok</div>';
Â  }else{
Â  Â  onlineList.innerHTML=onlineUsers.map((x,i)=>`
Â  Â  Â  <div style="padding:14px 12px;border-bottom:1px solid rgba(148,163,184,0.35);background:${i%2===0?'transparent':'rgba(148,163,184,0.08)'};border-radius:10px;margin-bottom:8px;font-size:13px;line-height:1.5">
Â  Â  Â  Â  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  <strong style="color:var(--primary);font-size:15px;font-weight:800">${x.kullanici_adi}</strong>
Â  Â  Â  Â  Â  Â  <span style="background:${x.durum==='aktif'?'#d1fae5':'#fee2e2'};color:${x.durum==='aktif'?'#065f46':'#b91c1c'};padding:3px 9px;border-radius:999px;font-size:11px;font-weight:700;margin-left:8px">${x.durum.toUpperCase()}</span>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <span style="color:#22c55e;font-size:24px;animation:pulse 1.5s infinite">â—</span>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div style="display:flex;gap:14px;font-size:13px;color:var(--text-main);font-weight:600;flex-wrap:wrap">
Â  Â  Â  Â  Â  <span>ğŸ“¦ <strong>${x.paket_tipi}</strong></span>
Â  Â  Â  Â  Â  <span>ğŸ“Š <strong>${x.kullanilan_kota_gb} GB</strong></span>
Â  Â  Â  Â  Â  <span>ğŸ’° <strong>${x.monthly_price?x.monthly_price+'â‚º':'-'}</strong></span>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  `).join('');
Â  }
Â Â 
Â  const upcoming=u.filter(x=>x.days_until_payment!==null&&x.days_until_payment>=0&&x.days_until_payment<=15)
Â  Â  Â  Â  Â  Â  Â  Â  Â  .sort((a,b)=>a.days_until_payment-b.days_until_payment);
Â  const payList=document.getElementById('upcomingPaymentsList');
Â  if(!upcoming.length){
Â  Â  payList.innerHTML='<div style="color:#9ca3af;padding:18px;text-align:center;font-weight:600;font-size:13px;">15 gÃ¼n iÃ§inde Ã¶deme yok</div>';
Â  }else{
Â  Â  payList.innerHTML=upcoming.map((x,i)=>{
Â  Â  Â  let color=x.days_until_payment<=3?'#ef4444':x.days_until_payment<=7?'#f59e0b':'#0ea5e9';
Â  Â  Â  let icon=x.days_until_payment<=3?'ğŸ”´':x.days_until_payment<=7?'ğŸŸ¡':'ğŸ”µ';
Â  Â  Â  let bg=i%2===0?'transparent':'rgba(148,163,184,0.08)';
Â  Â  Â  return `
Â  Â  Â  Â  <div style="padding:14px 12px;border-bottom:1px solid rgba(148,163,184,0.35);background:${bg};border-radius:10px;margin-bottom:8px;border-left:4px solid ${color};font-size:13px;line-height:1.5">
Â  Â  Â  Â  Â  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  <strong style="color:var(--primary);font-size:15px;font-weight:800">${x.kullanici_adi}</strong>
Â  Â  Â  Â  Â  Â  Â  <span style="background:${x.durum==='aktif'?'#d1fae5':'#fee2e2'};color:${x.durum==='aktif'?'#065f46':'#b91c1c'};padding:3px 9px;border-radius:999px;font-size:11px;font-weight:700;margin-left:8px">${x.durum.toUpperCase()}</span>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <span style="color:${color};font-weight:800;font-size:14px">${icon} ${x.days_until_payment}g</span>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div style="display:flex;justify-content:space-between;font-size:13px;color:var(--text-main);font-weight:600">
Â  Â  Â  Â  Â  Â  <span>ğŸ’° <strong>${x.monthly_price||0}â‚º</strong></span>
Â  Â  Â  Â  Â  Â  <span>ğŸ“… <strong>${x.next_payment_date||''}</strong></span>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  `;
Â  Â  }).join('');
Â  }
}

function applyFilters(){
Â  const search=document.getElementById('searchInput').value.toLowerCase();
Â  let filtered=allUsers.filter(user=>{
Â  Â  const matchesSearch=user.kullanici_adi.toLowerCase().includes(search) ||
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  (user.notes && user.notes.toLowerCase().includes(search));
Â  Â  const matchesFolder=currentFolderFilter==='TÃ¼mÃ¼'||user.folder===currentFolderFilter;
Â  Â  return matchesSearch&&matchesFolder;
Â  });
Â  displayUsers(filtered);
Â  displayUserCards(filtered);
}

function getAvatarColor(folder){
Â  switch(folder){
Â  Â  case 'GSM':return '#f97316';
Â  Â  case 'AX':return '#06b6d4';
Â  Â  case 'Superbox':return '#22c55e';
Â  Â  case 'Ã–ZEL':return '#8b5cf6';
Â  Â  case 'KLASÃ–R-1':return '#6366f1';
Â  Â  case 'KLASÃ–R-2':return '#0ea5e9';
Â  Â  case 'KLASÃ–R-3':return '#14b8a6';
Â  Â  case 'KLASÃ–R-4':return '#facc15';
Â  Â  default:return '#4b5563';
Â  }
}

function displayUsers(u){
Â  const tb=document.getElementById('usersTableBody');
Â  selectedUsers=new Set();
Â  document.getElementById('bulkSelectAll').checked=false;
Â  updateBulkBarState();
Â Â 
Â  if(!u.length){
Â  Â  tb.innerHTML='<tr><td colspan="13" style="text-align:center;font-weight:600;padding:26px 10px">KullanÄ±cÄ± bulunamadÄ±</td></tr>';
Â  Â  return;
Â  }
Â Â 
Â  tb.innerHTML=u.map(x=>{
Â  Â  const qp=x.kota_limit_gb!=="SÄ±nÄ±rsÄ±z" && x.kota_limit_gb>0 ? Math.min((x.kullanilan_kota_gb/x.kota_limit_gb)*100,100):0;
Â  Â  const pb=x.paket_tipi==='SÄ±nÄ±rsÄ±z'?'badge-unlimited':x.paket_tipi==='Gold'?'badge-gold':'badge-bronze';
Â  Â  const isActive=x.durum==='aktif';
Â  Â Â 
Â  Â  let onlineIndicator='';
Â  Â  if(x.online_status==='online'){
Â  Â  Â  onlineIndicator=`<div class="online-indicator"><span class="online-dot online">ğŸŸ¢</span><span class="online-time">${x.son_gorunme_kisa}</span></div>`;
Â  Â  }else if(x.online_status==='idle'){
Â  Â  Â  onlineIndicator=`<div class="online-indicator"><span class="online-dot">ğŸŸ¡</span><span class="online-time">${x.son_gorunme_kisa}</span></div>`;
Â  Â  }else if(x.online_status==='offline'){
Â  Â  Â  onlineIndicator=`<div class="online-indicator"><span class="online-dot">âš«</span><span class="online-time">${x.son_gorunme_kisa}</span></div>`;
Â  Â  }else{
Â  Â  Â  onlineIndicator=`<div class="online-indicator"><span class="online-dot">âšª</span><span class="online-time">${x.son_gorunme_kisa}</span></div>`;
Â  Â  }
Â  Â Â 
Â  Â  let paymentBadge='-';
Â  Â  if(x.payment_status==='overdue'){
Â  Â  Â  paymentBadge=`<span class="payment-status payment-overdue">ğŸ”´ ${Math.abs(x.days_until_payment)}g</span>`;
Â  Â  }else if(x.payment_status==='urgent'){
Â  Â  Â  paymentBadge=`<span class="payment-status payment-urgent">ğŸŸ  ${x.days_until_payment}g</span>`;
Â  Â  }else if(x.payment_status==='warning'){
Â  Â  Â  paymentBadge=`<span class="payment-status payment-warning">ğŸŸ¡ ${x.days_until_payment}g</span>`;
Â  Â  }else if(x.payment_status==='ok'){
Â  Â  Â  paymentBadge=`<span class="payment-status payment-ok">ğŸŸ¢ ${x.days_until_payment}g</span>`;
Â  Â  }
Â  Â Â 
Â  Â  const quotaDays=x.quota_days!==null?`${x.quota_days}g kala`:'-';
Â  Â Â 
Â  Â  let noteDisplay='',noteClass='note-cell empty';
Â  Â  if(x.notes && x.notes.trim()){
Â  Â  Â  noteDisplay=x.notes;
Â  Â  Â  noteClass='note-cell has-note';
Â  Â  }else noteDisplay='Not ekle...';
Â  Â Â 
Â  Â  const avatarColor=getAvatarColor(x.folder||'TÃ¼mÃ¼');
Â  Â  const initial=(x.kullanici_adi||'?').charAt(0).toUpperCase();
Â  Â Â 
Â  Â  return `
Â  Â  Â  <tr data-email="${x.email}">
Â  Â  Â  Â  <td>
Â  Â  Â  Â  Â  <input type="checkbox" class="row-checkbox" data-email="${x.email}" onchange="toggleRowSelection('${x.email}',this.checked)">
Â  Â  Â  Â  </td>
Â  Â  Â  Â  <td>
Â  Â  Â  Â  Â  <div class="user-cell">
Â  Â  Â  Â  Â  Â  <div class="user-avatar" style="background:${avatarColor};">${initial}</div>
Â  Â  Â  Â  Â  Â  <div class="user-meta">
Â  Â  Â  Â  Â  Â  Â  <div class="user-name">${x.kullanici_adi}</div>
Â  Â  Â  Â  Â  Â  Â  <div class="user-folder-tag">${x.folder||'TÃ¼mÃ¼'}</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </td>
Â  Â  Â  Â  <td>
Â  Â  Â  Â  Â  <div class="${noteClass}" onclick="openNote('${x.email}')" title="${(x.notes||'').replace(/"/g,'&quot;')}">${noteDisplay}</div>
Â  Â  Â  Â  </td>
Â  Â  Â  Â  <td><span class="badge ${pb}">${x.paket_tipi}</span></td>
Â  Â  Â  Â  <td>${x.kota_limit_gb==="SÄ±nÄ±rsÄ±z"?'â™¾ï¸':x.kota_limit_gb+' GB'}</td>
Â  Â  Â  Â  <td>
Â  Â  Â  Â  Â  ${
Â  Â  Â  Â  Â  Â  x.kota_limit_gb!=="SÄ±nÄ±rsÄ±z"
Â  Â  Â  Â  Â  Â  ? `<div class="progress-bar"><div class="progress-fill" style="width:${qp}%"></div></div>
Â  Â  Â  Â  Â  Â  Â  Â <div style="font-size:10px;color:var(--text-soft);font-weight:600;margin-top:2px">${x.kullanilan_kota_gb}/${x.kota_limit_gb} GB</div>`
Â  Â  Â  Â  Â  Â  : `${x.kullanilan_kota_gb} GB`
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  </td>
Â  Â  Â  Â  <td><strong style="color:#7c3aed">${x.toplam_kullanim_gb} GB</strong></td>
Â  Â  Â  Â  <td><span class="badge ${isActive?'badge-active':'badge-passive'}">${x.durum.toUpperCase()}</span></td>
Â  Â  Â  Â  <td>${onlineIndicator}</td>
Â  Â  Â  Â  <td><strong>${x.monthly_price?x.monthly_price+'â‚º':'-'}</strong></td>
Â  Â  Â  Â  <td>${paymentBadge}</td>
Â  Â  Â  Â  <td class="actions-cell">
Â  Â  Â  Â  Â  <div class="toggle-container">
Â  Â  Â  Â  Â  Â  <label class="toggle-switch">
Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" ${isActive?'checked':''} onchange="toggleUser('${x.email}',this.checked)">
Â  Â  Â  Â  Â  Â  Â  <span class="slider"></span>
Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  <button class="action-btn btn-settings" onclick="openSettings('${x.email}')">âš™ï¸</button>
Â  Â  Â  Â  Â  Â  <button class="action-btn btn-payment" onclick="openPayment('${x.email}')">ğŸ’°</button>
Â  Â  Â  Â  Â  Â  <button class="action-btn btn-folder-move" onclick="moveToFolder('${x.email}')">ğŸ“</button>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </td>
Â  Â  Â  </tr>
Â  Â  `;
Â  }).join('');
}

function displayUserCards(u){
Â  const cont=document.getElementById('usersCardsContainer');
Â  if(!u.length){
Â  Â  cont.innerHTML='<div style="text-align:center;padding:18px 6px;font-weight:600;color:#9ca3af;display:none;">KullanÄ±cÄ± bulunamadÄ±</div>';
Â  Â  return;
Â  }
Â  cont.innerHTML=u.map(x=>{
Â  Â  const avatarColor=getAvatarColor(x.folder||'TÃ¼mÃ¼');
Â  Â  const initial=(x.kullanici_adi||'?').charAt(0).toUpperCase();
Â  Â  const isActive=x.durum==='aktif';
Â  Â  const quotaText=x.kota_limit_gb==="SÄ±nÄ±rsÄ±z"?'SÄ±nÄ±rsÄ±z':`${x.kullanilan_kota_gb}/${x.kota_limit_gb} GB`;
Â  Â  let paymentShort='-';
Â  Â  if(x.payment_status && x.days_until_payment!==null){
Â  Â  Â  paymentShort=`${x.days_until_payment}g`;
Â  Â  }
Â  Â Â 
Â  Â  return `
Â  Â  Â  <div class="user-card">
Â  Â  Â  Â  <div class="user-card-header">
Â  Â  Â  Â  Â  <div class="user-card-main">
Â  Â  Â  Â  Â  Â  <div class="user-avatar" style="background:${avatarColor};">${initial}</div>
Â  Â  Â  Â  Â  Â  <div class="user-meta">
Â  Â  Â  Â  Â  Â  Â  <div class="user-name">${x.kullanici_adi}</div>
Â  Â  Â  Â  Â  Â  Â  <div class="user-folder-tag">${x.folder||'TÃ¼mÃ¼'}</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <span class="badge ${isActive?'badge-active':'badge-passive'}">${x.durum.toUpperCase()}</span>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="user-card-stats">
Â  Â  Â  Â  Â  <span>ğŸ“¦ <strong>${x.paket_tipi}</strong></span>
Â  Â  Â  Â  Â  <span>ğŸ“Š <strong>${quotaText}</strong></span>
Â  Â  Â  Â  Â  <span>ğŸ’° <strong>${x.monthly_price?x.monthly_price+'â‚º':'-'}</strong></span>
Â  Â  Â  Â  Â  <span>ğŸ“… <strong>${x.next_payment_date||'-'}</strong></span>
Â  Â  Â  Â  Â  <span>â±ï¸ <strong>${paymentShort}</strong></span>
Â  Â  Â  Â  Â  <span>ğŸ”„ <strong>${x.quota_days||'-'}</strong></span>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div style="margin-top:6px;display:flex;gap:4px;flex-wrap:wrap">
Â  Â  Â  Â  Â  <button class="action-btn btn-settings" onclick="openSettings('${x.email}')">âš™ï¸ Ayar</button>
Â  Â  Â  Â  Â  <button class="action-btn btn-payment" onclick="openPayment('${x.email}')">ğŸ’° Ã–deme</button>
Â  Â  Â  Â  Â  <button class="action-btn btn-note" onclick="openNote('${x.email}')">ğŸ“ Not</button>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  `;
Â  }).join('');
}

function filterUsers(){applyFilters();}

function filterByFolder(folder){
Â  currentFolderFilter=folder;
Â  document.querySelectorAll('.btn-folder').forEach(btn=>btn.classList.remove('active'));
Â  event.target.classList.add('active');
Â  applyFilters();
}

function openSettings(email){
Â  currentSettingsEmail=email;
Â  const user=allUsers.find(u=>u.email===email);
Â  if(!user)return;
Â  document.getElementById('settingsUserName').textContent=email;
Â  document.getElementById('settingsQuota').value=user.kota_limit_gb==="SÄ±nÄ±rsÄ±z"?"0":user.kota_limit_gb;
Â  document.getElementById('settingsPrice').value=user.monthly_price||0;
Â  document.getElementById('settingsExpiryDate').value=user.expiry_date_only||user.next_payment_date||'';
Â  document.getElementById('settingsNotes').value=user.notes||'';
Â  document.getElementById('settingsFolder').value=user.folder||'TÃ¼mÃ¼';
Â  document.getElementById('settingsModal').classList.add('active');
}

function closeSettingsModal(){
Â  document.getElementById('settingsModal').classList.remove('active');
}

async function saveSettings(){
Â  const overlay=document.getElementById('loadingOverlay');
Â  overlay.classList.add('active');
Â  try{
Â  Â  const data={
Â  Â  Â  email:currentSettingsEmail,
Â  Â  Â  quota:document.getElementById('settingsQuota').value,
Â  Â  Â  expiry_date:document.getElementById('settingsExpiryDate').value,
Â  Â  Â  monthly_price:parseFloat(document.getElementById('settingsPrice').value)||0,
Â  Â  Â  next_payment_date:document.getElementById('settingsExpiryDate').value,
Â  Â  Â  notes:document.getElementById('settingsNotes').value,
Â  Â  Â  folder:document.getElementById('settingsFolder').value
Â  Â  };
Â  Â  const r=await fetch('/api/update-user-settings',{
Â  Â  Â  method:'POST',
Â  Â  Â  headers:{'Content-Type':'application/json'},
Â  Â  Â  credentials:'include',
Â  Â  Â  body:JSON.stringify(data)
Â  Â  });
Â  Â  const d=await r.json();
Â  Â  if(d.success){
Â  Â  Â  closeSettingsModal();
Â  Â  Â  await loadData();
Â  Â  Â  loadNotifications();
Â  Â  }else alert('Hata: '+d.message);
Â  }catch(e){alert('BaÄŸlantÄ± hatasÄ±!');}
Â  finally{overlay.classList.remove('active');}
}

function openNote(email){
Â  currentNoteEmail=email;
Â  const user=allUsers.find(u=>u.email===email);
Â  if(!user)return;
Â  document.getElementById('noteUserName').textContent=email;
Â  document.getElementById('noteText').value=user.notes||'';
Â  document.getElementById('noteModal').classList.add('active');
}

function closeNoteModal(){
Â  document.getElementById('noteModal').classList.remove('active');
}

async function saveNote(){
Â  const overlay=document.getElementById('loadingOverlay');
Â  overlay.classList.add('active');
Â  try{
Â  Â  const note=document.getElementById('noteText').value;
Â  Â  const r=await fetch('/api/update-user-note',{
Â  Â  Â  method:'POST',
Â  Â  Â  headers:{'Content-Type':'application/json'},
Â  Â  Â  credentials:'include',
Â  Â  Â  body:JSON.stringify({email:currentNoteEmail,note})
Â  Â  });
Â  Â  const d=await r.json();
Â  Â  if(d.success){
Â  Â  Â  closeNoteModal();
Â  Â  Â  await loadData();
Â  Â  Â  loadNotifications();
Â  Â  }else alert('Hata: '+d.message);
Â  }catch(e){alert('BaÄŸlantÄ± hatasÄ±!');}
Â  finally{overlay.classList.remove('active');}
}

async function openPayment(email){
Â  currentPaymentEmail=email;
Â  const user=allUsers.find(u=>u.email===email);
Â  if(!user)return;
Â  document.getElementById('paymentUserName').textContent=email;
Â  document.getElementById('paymentAmount').value=user.monthly_price||0;
Â  document.getElementById('paymentDate').value=new Date().toISOString().split('T')[0];
Â  try{
Â  Â  const r=await fetch(`/api/payment-history/${email}`,{credentials:'include'});
Â  Â  const history=await r.json();
Â  Â  if(history.length){
Â  Â  Â  document.getElementById('paymentHistorySection').style.display='block';
Â  Â  Â  document.getElementById('paymentHistoryList').innerHTML=history.map(h=>`
Â  Â  Â  Â  <div class="payment-item">
Â  Â  Â  Â  Â  <strong>${h.payment_date}</strong> - ${h.amount}â‚º<br>
Â  Â  Â  Â  Â  <span style="font-size:12px;color:#6b7280;font-weight:600">${h.payment_method||''} ${h.notes?'- '+h.notes:''}</span>
Â  Â  Â  Â  </div>
Â  Â  Â  `).join('');
Â  Â  }else document.getElementById('paymentHistorySection').style.display='none';
Â  }catch(e){}
Â  document.getElementById('paymentModal').classList.add('active');
}

function closePaymentModal(){
Â  document.getElementById('paymentModal').classList.remove('active');
}

async function savePayment(){
Â  const overlay=document.getElementById('loadingOverlay');
Â  overlay.classList.add('active');
Â  try{
Â  Â  const data={
Â  Â  Â  email:currentPaymentEmail,
Â  Â  Â  amount:parseFloat(document.getElementById('paymentAmount').value)||0,
Â  Â  Â  payment_date:document.getElementById('paymentDate').value,
Â  Â  Â  payment_method:document.getElementById('paymentMethod').value,
Â  Â  Â  notes:document.getElementById('paymentNote').value
Â  Â  };
Â  Â  const r=await fetch('/api/add-payment',{
Â  Â  Â  method:'POST',
Â  Â  Â  headers:{'Content-Type':'application/json'},
Â  Â  Â  credentials:'include',
Â  Â  Â  body:JSON.stringify(data)
Â  Â  });
Â  Â  const d=await r.json();
Â  Â  if(d.success){
Â  Â  Â  closePaymentModal();
Â  Â  Â  await loadData();
Â  Â  Â  loadNotifications();
Â  Â  }else alert('Hata: '+d.message);
Â  }catch(e){alert('BaÄŸlantÄ± hatasÄ±!');}
Â  finally{overlay.classList.remove('active');}
}

function toggleExportMenu(){
Â  document.getElementById('exportMenu').classList.toggle('active');
}

function exportToExcel(){
Â  const data=allUsers.map(u=>({
Â  Â  'KullanÄ±cÄ±':u.kullanici_adi,
Â  Â  'Not':u.notes||'',
Â  Â  'Paket':u.paket_tipi,
Â  Â  'Limit':u.kota_limit_gb,
Â  Â  'KullanÄ±m':u.kullanilan_kota_gb,
Â  Â  'T.KullanÄ±m':u.toplam_kullanim_gb,
Â  Â  'Durum':u.durum,
Â  Â  'Fiyat':u.monthly_price||0,
Â  Â  'Ã–deme':u.next_payment_date||'',
Â  Â  'Kota GÃ¼n':u.quota_days||'-'
Â  }));
Â  const ws=XLSX.utils.json_to_sheet(data);
Â  const wb=XLSX.utils.book_new();
Â  XLSX.utils.book_append_sheet(wb,ws,"KullanÄ±cÄ±lar");
Â  XLSX.writeFile(wb,`NovaCell-3-v4.5_${new Date().toISOString().split('T')[0]}.xlsx`);
Â  document.getElementById('exportMenu').classList.remove('active');
}

function exportToPDF(){
Â  const{jsPDF}=window.jspdf;
Â  const doc=new jsPDF();
Â  doc.text('NovaCell-3',14,15);
Â  doc.autoTable({
Â  Â  startY:25,
Â  Â  head:[['KullanÄ±cÄ±','Not','Paket','KullanÄ±m','T.KullanÄ±m']],
Â  Â  body:allUsers.map(u=>[
Â  Â  Â  u.kullanici_adi,
Â  Â  Â  u.notes||'-',
Â  Â  Â  u.paket_tipi,
Â  Â  Â  u.kullanilan_kota_gb+' GB',
Â  Â  Â  u.toplam_kullanim_gb+' GB'
Â  Â  ])
Â  });
Â  doc.save(`NovaCell-3-v4.5_${new Date().toISOString().split('T')[0]}.pdf`);
Â  document.getElementById('exportMenu').classList.remove('active');
}

document.addEventListener('click',function(e){
Â  if(!e.target.closest('.export-btn')&&!e.target.closest('.export-menu')){
Â  Â  document.getElementById('exportMenu').classList.remove('active');
Â  }
Â  if(!e.target.closest('.notification-bell')&&!e.target.closest('.notification-panel')){
Â  Â  document.getElementById('notificationPanel').classList.remove('active');
Â  }
});

async function moveToFolder(email){
Â  const currentFolder=allUsers.find(u=>u.email===email)?.folder||'TÃ¼mÃ¼';
Â  const folders=['TÃ¼mÃ¼','Superbox','AX','GSM','Ã–ZEL','KLASÃ–R-1','KLASÃ–R-2','KLASÃ–R-3','KLASÃ–R-4'];
Â  const modal=document.createElement('div');
Â  modal.style.cssText=`
Â  Â  position:fixed;top:0;left:0;width:100%;height:100%;
Â  Â  background:rgba(15,23,42,0.7);display:flex;justify-content:center;align-items:center;
Â  Â  z-index:9999;font-family:inherit;
Â  `;
Â  modal.innerHTML=`
Â  Â  <div style="background:var(--card-bg);padding:18px 18px 16px;border-radius:16px;max-width:380px;width:90%;border:var(--card-border);box-shadow:var(--card-shadow);">
Â  Â  Â  <h3 style="margin-bottom:10px;color:var(--primary);font-size:17px;font-weight:800;text-align:center;">ğŸ“ KlasÃ¶re TaÅŸÄ±</h3>
Â  Â  Â  <p style="margin-bottom:6px;color:var(--text-main);font-size:13px;text-align:center;">KullanÄ±cÄ±: <strong>${email}</strong></p>
Â  Â  Â  <p style="margin-bottom:12px;color:var(--text-soft);font-size:12px;text-align:center;">Mevcut: <strong>${currentFolder}</strong></p>
Â  Â  Â  <select id="folderSelect" style="width:100%;padding:9px;border-radius:10px;border:2px solid rgba(148,163,184,0.6);margin-bottom:12px;font-size:13px;font-weight:600;background:var(--card-bg);color:var(--text-main);">
Â  Â  Â  Â  ${folders.map(f=>`<option value="${f}" ${f===currentFolder?'selected':''}>${f}</option>`).join('')}
Â  Â  Â  </select>
Â  Â  Â  <div style="display:flex;gap:8px;justify-content:center;">
Â  Â  Â  Â  <button id="confirmBtn" style="padding:8px 14px;background:linear-gradient(135deg,#6366f1,#8b5cf6);color:#fff;border:none;border-radius:999px;cursor:pointer;font-weight:700;font-size:13px;">Tamam</button>
Â  Â  Â  Â  <button id="cancelBtn" style="padding:8px 14px;background:rgba(148,163,184,0.25);color:var(--text-main);border:none;border-radius:999px;cursor:pointer;font-weight:700;font-size:13px;">Ä°ptal</button>
Â  Â  Â  </div>
Â  Â  </div>
Â  `;
Â  document.body.appendChild(modal);
Â  document.getElementById('confirmBtn').addEventListener('click',async()=>{
Â  Â  const newFolder=document.getElementById('folderSelect').value;
Â  Â  if(!newFolder||!folders.includes(newFolder)){alert('GeÃ§ersiz klasÃ¶r!');return;}
Â  Â  const overlay=document.getElementById('loadingOverlay');
Â  Â  overlay.classList.add('active');
Â  Â  try{
Â  Â  Â  const r=await fetch('/api/move-to-folder',{
Â  Â  Â  Â  method:'POST',
Â  Â  Â  Â  headers:{'Content-Type':'application/json'},
Â  Â  Â  Â  credentials:'include',
Â  Â  Â  Â  body:JSON.stringify({email,folder:newFolder})
Â  Â  Â  });
Â  Â  Â  const d=await r.json();
Â  Â  Â  document.body.removeChild(modal);
Â  Â  Â  if(d.success){
Â  Â  Â  Â  await loadData();
Â  Â  Â  Â  loadNotifications();
Â  Â  Â  Â  alert(`âœ… ${email} â†’ ${newFolder}`);
Â  Â  Â  }else alert(`âŒ Hata: ${d.message}`);
Â  Â  }catch(e){alert('BaÄŸlantÄ± hatasÄ±!');}
Â  Â  finally{overlay.classList.remove('active');}
Â  });
Â  document.getElementById('cancelBtn').addEventListener('click',()=>{document.body.removeChild(modal);});
}

function toggleRowSelection(email,checked){
Â  if(checked)selectedUsers.add(email);
Â  else selectedUsers.delete(email);
Â  updateBulkBarState();
}

function toggleSelectAll(checked){
Â  document.querySelectorAll('.row-checkbox').forEach(cb=>{
Â  Â  cb.checked=checked;
Â  Â  const email=cb.dataset.email;
Â  Â  if(email){
Â  Â  Â  if(checked)selectedUsers.add(email);
Â  Â  Â  else selectedUsers.delete(email);
Â  Â  }
Â  });
Â  updateBulkBarState();
}

function updateBulkBarState(){
Â  const count=selectedUsers.size;
Â  document.getElementById('bulkSelectedCount').textContent=`${count} seÃ§ili`;
Â  const disabled=count===0;
Â  document.getElementById('bulkMoveBtn').disabled=disabled;
Â  document.getElementById('bulkActivateBtn').disabled=disabled;
Â  document.getElementById('bulkDeactivateBtn').disabled=disabled;
}

async function bulkMove(){
Â  if(!selectedUsers.size){alert('LÃ¼tfen kullanÄ±cÄ± seÃ§in');return;}
Â  const folder=document.getElementById('bulkFolderSelect').value;
Â  if(!folder){alert('KlasÃ¶r seÃ§in');return;}
Â  const overlay=document.getElementById('loadingOverlay');
Â  overlay.classList.add('active');
Â  const initialCount = selectedUsers.size;
Â  try{
Â  Â  for(const email of selectedUsers){
Â  Â  Â  await fetch('/api/move-to-folder',{
Â  Â  Â  Â  method:'POST',
Â  Â  Â  Â  headers:{'Content-Type':'application/json'},
Â  Â  Â  Â  credentials:'include',
Â  Â  Â  Â  body:JSON.stringify({email,folder})
Â  Â  Â  });
Â  Â  }
Â  Â  await loadData();
Â  Â  loadNotifications();
Â  Â  alert(`âœ… ${initialCount} kullanÄ±cÄ± ${folder}'e taÅŸÄ±ndÄ±`);
Â  Â  selectedUsers.clear();
Â  Â  document.getElementById('bulkSelectAll').checked=false;
Â  Â  updateBulkBarState();
Â  }catch(e){alert('Hata!');}
Â  finally{overlay.classList.remove('active');}
}

async function bulkToggle(enable){
Â  if(!selectedUsers.size){alert('LÃ¼tfen kullanÄ±cÄ± seÃ§in');return;}
Â  const overlay=document.getElementById('loadingOverlay');
Â  overlay.classList.add('active');
Â  try{
Â  Â  for(const email of selectedUsers){
Â  Â  Â  await fetch('/api/toggle-user',{
Â  Â  Â  Â  method:'POST',
Â  Â  Â  Â  headers:{'Content-Type':'application/json'},
Â  Â  Â  Â  credentials:'include',
Â  Â  Â  Â  body:JSON.stringify({email,enable})
Â  Â  Â  });
Â  Â  }
Â  Â  await loadData();
Â  Â  loadNotifications();
Â  Â  alert(`âœ… ${selectedUsers.size} kullanÄ±cÄ± ${enable?'aktif':'pasif'}`);
Â  Â  selectedUsers.clear();
Â  Â  document.getElementById('bulkSelectAll').checked=false;
Â  Â  updateBulkBarState();
Â  }catch(e){alert('Hata!');}
Â  finally{overlay.classList.remove('active');}
}

async function toggleUser(email,enable){
Â  const overlay=document.getElementById('loadingOverlay');
Â  overlay.classList.add('active');
Â  try{
Â  Â  const r=await fetch('/api/toggle-user',{
Â  Â  Â  method:'POST',
Â  Â  Â  headers:{'Content-Type':'application/json'},
Â  Â  Â  credentials:'include',
Â  Â  Â  body:JSON.stringify({email,enable})
Â  Â  });
Â  Â  const d=await r.json();
Â  Â  if(d.success){
Â  Â  Â  alert(`âœ… ${email} ${enable?'aktif':'pasif'}`);
Â  Â  }else{
Â  Â  Â  alert('Hata: '+d.message);
Â  Â  Â  const row=document.querySelector(`tr[data-email="${email}"]`);
Â  Â  Â  if(row){
Â  Â  Â  Â  const toggleInput=row.querySelector('.toggle-switch input');
Â  Â  Â  Â  if(toggleInput)toggleInput.checked=!enable;
Â  Â  Â  }
Â  Â  }
Â  }catch(e){alert('Hata!');}
Â  finally{overlay.classList.remove('active');}
}

async function refreshData(){
Â  const btn=event.target;
Â  btn.disabled=true;
Â  btn.textContent='â³';
Â  try{
Â  Â  await loadData();
Â  Â  loadNotifications();
Â  Â  btn.textContent='âœ…';
Â  Â  setTimeout(()=>{btn.textContent='ğŸ”„ Yenile';btn.disabled=false;},1500);
Â  }catch(e){
Â  Â  btn.textContent='âŒ';
Â  Â  setTimeout(()=>{btn.textContent='ğŸ”„ Yenile';btn.disabled=false;},1500);
Â  }
}

setInterval(()=>{
Â  if(document.getElementById('dashboardPage').classList.contains('active')){
Â  Â  loadData();
Â  Â  loadNotifications();
Â  }
},30000);
</script>
</body>
</html>
